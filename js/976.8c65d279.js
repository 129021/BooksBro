"use strict";(self["webpackChunkmy_vue3_project"]=self["webpackChunkmy_vue3_project"]||[]).push([[976],{771:function(r,t,a){a.d(t,{Fw:function(){return i},LV:function(){return s},LX:function(){return d},Nc:function(){return u},_r:function(){return n},dz:function(){return l},jo:function(){return o}});var e=a(7707);function s(r){return(0,e.W)({url:"/api/orders",method:"post",params:r})}function o(){return(0,e.W)({url:"/api/orders/preview",method:"get"})}function n(r,t){return(0,e.W)({url:`/api/orders/${r}/pay`,method:"get",params:t})}function d(r){return(0,e.W)({url:`/api/orders/${r}/status`,method:"get"})}function i(r){return(0,e.W)({url:"/api/orders",method:"get",params:r})}function l(r){return(0,e.W)({url:`/api/orders/${r}`,method:"get",params:{include:"orderDetails.goods,address,user"}})}function u(r){return(0,e.W)({url:`/api/orders/${r}/confirm`,method:"patch"})}},920:function(r,t,a){a.d(t,{Z:function(){return f}});var e=a(3396),s=a(2291);const o=r=>((0,e.dD)("data-v-22cb7b90"),r=r(),(0,e.Cn)(),r),n={class:"nav-bar"},d=o((()=>(0,e._)("img",{src:s,alt:""},null,-1))),i={class:"center"},l=(0,e.Uk)("default"),u={class:"right"};function c(r,t,a,s,o,c){return(0,e.wg)(),(0,e.iD)("div",n,[(0,e._)("div",{class:"left",onClick:t[0]||(t[0]=(...r)=>s.goback&&s.goback(...r))},[(0,e.WI)(r.$slots,"left",{},(()=>[d]),!0)]),(0,e._)("div",i,[(0,e.WI)(r.$slots,"default",{},(()=>[l]),!0)]),(0,e._)("div",u,[(0,e.WI)(r.$slots,"right",{},void 0,!0)])])}var p=a(678),g={name:"NavBar",setup(){const r=(0,p.tv)(),t=()=>{r.go(-1)};return{goback:t}}},v=a(89);const m=(0,v.Z)(g,[["render",c],["__scopeId","data-v-22cb7b90"]]);var f=m},1976:function(r,t,a){a.r(t),a.d(t,{default:function(){return N}});var e=a(3396),s=a(7139);const o=r=>((0,e.dD)("data-v-c1b7a5a0"),r=r(),(0,e.Cn)(),r),n={class:"create-order"},d=(0,e.Uk)(" 定单预览 "),i={class:"address-wrap",style:{"margin-top":"50px"}},l={class:"address"},u={class:"good"},c={class:"good-img"},p={alt:""},g={class:"good-desc"},v={class:"good-title"},m={class:"good-btn"},f={class:"price"},h=o((()=>(0,e._)("small",null,"¥",-1))),w=(0,e.Uk)(" 商品金额 "),A=(0,e.Uk)(" 支付宝二维码"),_=o((()=>(0,e._)("br",null,null,-1))),b=(0,e.Uk)(" 微信二维码"),k=o((()=>(0,e._)("br",null,null,-1)));function y(r,t,a,o,y,W){const C=(0,e.up)("nav-bar"),L=(0,e.up)("van-icon"),D=(0,e.up)("van-submit-bar"),U=(0,e.up)("van-image"),B=(0,e.up)("van-grid-item"),I=(0,e.up)("van-grid"),z=(0,e.up)("van-popup"),E=(0,e.Q2)("lazy");return(0,e.wg)(),(0,e.iD)("div",n,[(0,e.Wm)(C,{class:"nav-bar"},{default:(0,e.w5)((()=>[d])),_:1}),(0,e._)("div",i,[(0,e._)("div",{class:"name",onClick:t[0]||(t[0]=(...r)=>o.goTo&&o.goTo(...r))},[(0,e._)("span",null,(0,s.zw)(r.address.name),1),(0,e._)("span",null,(0,s.zw)(r.address.phone),1)]),(0,e._)("div",l,(0,s.zw)(r.address.province)+" "+(0,s.zw)(r.address.city)+" "+(0,s.zw)(r.address.county)+" "+(0,s.zw)(r.address.address),1),(0,e.Wm)(L,{class:"arrow",name:"arrow"})]),(0,e._)("div",u,[((0,e.wg)(!0),(0,e.iD)(e.HY,null,(0,e.Ko)(r.cartList,((r,t)=>((0,e.wg)(),(0,e.iD)("div",{class:"good-item",key:t},[(0,e._)("div",c,[(0,e.wy)((0,e._)("img",p,null,512),[[E,r.goods.cover_url]])]),(0,e._)("div",g,[(0,e._)("div",v,[(0,e._)("span",null,(0,s.zw)(r.goods.title),1),(0,e._)("span",null,"x"+(0,s.zw)(r.num),1)]),(0,e._)("div",m,[(0,e._)("div",f,[h,(0,e.Uk)(" "+(0,s.zw)(r.goods.price+".00"),1)])])])])))),128))]),(0,e.Wm)(D,{style:{"margin-bottom":"60px"},class:"submit-all",price:100*o.total,"button-text":"生成订单",onSubmit:o.handleCreateOrder},{default:(0,e.w5)((()=>[w])),_:1},8,["price","onSubmit"]),(0,e.Wm)(z,{closeable:"","close-on-click-overlay":!1,show:r.showPay,"onUpdate:show":t[1]||(t[1]=t=>r.showPay=t),position:"bottom",style:{height:"40%"},onClose:o.close},{default:(0,e.w5)((()=>[(0,e.Wm)(I,{border:!1,"column-num":2},{default:(0,e.w5)((()=>[(0,e.Wm)(B,{style:{"margin-top":"30px"}},{default:(0,e.w5)((()=>[A,_,(0,e.Wm)(U,{width:"150",height:"150",src:r.aliyun},null,8,["src"])])),_:1}),(0,e.Wm)(B,{style:{"margin-top":"30px"}},{default:(0,e.w5)((()=>[b,k,(0,e.Wm)(U,{width:"150",height:"150",src:r.wechat},null,8,["src"])])),_:1})])),_:1})])),_:1},8,["show","onClose"])])}a(6743);var W=a(4691),C=a(4870),L=a(920),D=a(771),U=a(678),B=a(65),I={components:{NavBar:L.Z},setup(){const r=(0,U.tv)(),t=((0,U.yj)(),(0,B.oR)()),a=(0,C.qj)({cartList:[],address:{},showPay:!1,orderNo:"",aliyun:"",wechat:""}),s=()=>{W.Z.loading({message:"加载中...",forbidClick:!0}),(0,D.jo)().then((r=>{let t=r.data.address.filter((r=>"1"==r.is_default));0==t.length?a.address={address:"还没有设置默认地址，请选择或填写地址信息"}:a.address=t[0],a.cartList=r.data.carts,W.Z.clear()}))};(0,e.bv)((()=>{s()}));const o=()=>{r.push({path:"/address"})},n=()=>{const e={address_id:a.address.id};(0,D.LV)(e).then((e=>{(0,W.Z)("创建定单成功"),t.dispatch("updateCart"),a.showPay=!0,a.orderNo=e.data.id,(0,D._r)(a.orderNo,{type:"aliyun"}).then((r=>{a.aliyun=r.data.qr_code_url,a.wechat=r.data.qr_code_url}));const s=setInterval((()=>{(0,D.LX)(a.orderNo).then((t=>{"2"==t.data&&(clearInterval(s),r.push({path:"/orderdetail",query:{id:a.orderNo}}))}))}),2e3)}))},d=()=>{r.push({path:"/orderdetail",query:{id:a.orderNo}})},i=(0,e.Fl)((()=>{let r=0;return a.cartList.forEach((t=>{r+=parseInt(t.num)*parseFloat(t.goods.price)})),r}));return{...(0,C.BK)(a),goTo:o,handleCreateOrder:n,close:d,total:i}}},z=a(89);const E=(0,z.Z)(I,[["render",y],["__scopeId","data-v-c1b7a5a0"]]);var N=E},2291:function(r){r.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAABk0lEQVRoQ+2Z3UYFURSA1/c8dVcv0H23iYiIiIiIiH5ERMQhIiIi0kPUfd3Vk/QAO5s5HJmzW2f/tbZm7saZGd+31p519lqDNH7QOL8MAn+dwSED/y4DzrkTEVkWkS8ReQX8efRRdQl18McTtJ/AfDS9SL0q1APvud+BRfMCU+A996n5JRSAPwLOUqLv7y36DgTgD4HzVPiiAgH4A+AiB3wxgQD8PnCZC76IgHPOl8m+2r4HXOWEzy4QgN8FRrnhswoE4HeA6xLw2QQC8NvATSn4LAIB+C3gtiR8skCg2mwCd6XhkwQC8BvAfQ34aIEA/DrwUAs+SiAAvwY81oSPFfgQkbkfoKvAU234WIE3EVloWcBvEya7qrFLG0vI0zb9Eo/D3XQZVUjY/yNTSNjfSigk7G/mFBL2t9MKCfsNjULCfkupkLDf1Csk7I9VFBL2B1sKCfujRYWE/eHuLxLtfB+Ysot9AZZSGqGi0+k+sG4Ms9L99mz++0BKdDX3Vs+ABmqWawaBWaJV4tohAyWiOsszvwGAjbUxED2S5gAAAABJRU5ErkJggg=="}}]);
//# sourceMappingURL=976.8c65d279.js.map